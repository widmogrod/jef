/*! jefs 2014-12-09 */
!function(){var a,b,c,d,e;a=function(){function a(){this.events={},this.eventsCallbacks=0}return a.constructor=a,a.prototype.eachEvent=function(a,b){a.split(/\s+/).forEach(function(a){b(a,this.events[a]=a in this.events?this.events[a]:[])}.bind(this))},a.prototype.on=function(a,b){return this.eachEvent(a,function(a,c){c.push(b),++this.eventsCallbacks}.bind(this)),this},a.prototype.once=function(a,b){return b.once=!0,this.on(a,b)},a.prototype.off=function(a,b){var c;return this.eachEvent(a,function(a,d){"function"==typeof b?(c=d.indexOf(b),-1!==c&&(d.splice(c,1),--this.eventsCallbacks)):(this.eventsCallbacks-=d.length,d.length=0)}.bind(this)),this},a.prototype.trigger=function(a,b,c){var d=this;return this.eachEvent(a,function(a,e){e.forEach(function(a,f){a.once&&(e.splice(f,1),--d.eventsCallbacks),a.apply(c||a,b)})}),this},a}(),b=function(a,b,c){return Array.prototype.slice.call(a,b,c)},c=function(a,b,c){function d(){var a,b=this.options.drain;for(this.options.drain=null;"undefined"!=typeof(a=b());)this.push(a);this.destroy()}function e(b){a.call(this),this.options=b||{},this.chain=[],this.buffer=[],this.filtered=!1,this.lastValue=[],this.closed=!1}return e.constructor=e,e.prototype=new a,e.prototype.isClosed=function(){return this.closed},e.prototype.hasReaders=function(){return this.eventsCallbacks>0},e.prototype.canDrain=function(){return"function"==typeof this.options.drain},e.prototype.on=function(b,c){var d=a.prototype.on.call(this,b,c);return this.trigger("drain"),d},e.prototype.pipe=function(a){if(!a instanceof e)throw new Error("You can pipe to another stream, but given "+a);if(this.isClosed())throw new Error("Stream is closed, can't pipe to another stream");if(a.isClosed())throw new Error("You can	 pipe to closed streams");return this.on("data",a.push.bind(a)),this.canDrain()?a.hasReaders()?(d.call(this),a):(a.on("drain",d.bind(this)),a):a},e.prototype.take=function(a,b,c){return this.chain.push(new e({take:{limit:a,skip:b||0,allowEmpty:!!c}})),this.chain[this.chain.length-1]},e.prototype.map=function(a){return this.chain.push(new e({apply:this.options.apply,map:a})),this.chain[this.chain.length-1]},e.prototype.accept=function(a){return this.chain.push(new e({apply:this.options.apply,filter:a})),this.chain[this.chain.length-1]},e.prototype.reject=function(a){return this.chain.push(new e({apply:this.options.apply,filter:function(){return!a.apply(a,arguments)}})),this.chain[this.chain.length-1]},e.prototype.reduce=function(a,b){return this.chain.push(new e({reduce:{func:a,base:b}})),this.chain[this.chain.length-1]},e.prototype.push=function(a){if(this.isClosed())throw new Error("Stream is closed, can't push data");if(this.canDrain())throw new Error("Stream can't push data because it has drain function");if(a=b(arguments),this.filtered=!1,this.lastValue=[],this.options.filter&&!this.options.filter.apply(this.options.filter,a))return this.filtered=!0,this.trigger("out",a,this);if(this.options.map&&(a="function"==typeof this.options.map?this.options.map.apply(this,a):this.options.map,a=Array.isArray(a)?a:[a]),this.options.reduce&&(a=this.options.reduce.func.apply(this,a.concat(this.options.reduce.base)),this.options.reduce.base=a,a=Array.isArray(a)?a:[a]),this.options.take){this.buffer.push(a);var c=this.buffer.length,d=c-this.options.take.skip,e=d-this.options.take.limit;if(e=0>e?0:e,a=this.buffer.slice(e,d),!this.options.allowEmpty&&a.length!==this.options.take.limit)return this}return this.lastValue=a,this.trigger("data",a,this),this.chain.forEach(function(b){b.push.apply(b,a)}),this},e.prototype.last=function(a){return a.apply(a,this.lastValue),this.on("data",a),this},e.prototype.merge=function(a){return e.merge(this,a)},e.prototype.destroy=function(){this.trigger("closed"),this.options.destroy&&this.options.destroy(),this.chain.forEach(function(a){a.destroy()}),e.call(this),this.closed=!0},e.merge=function(){var a=b(arguments),c=[],d=new e({destroy:function(){a.forEach(function(a,b){a.off("data",c[b])})}});return a.forEach(function(a,b){a.on("data",c[b]=function(){d.push.apply(d,arguments)})}),d},e.when=function(){var a=b(arguments),c=[],d=new Array(a.length),f=new Array(a.length),g=new e({filter:function(a){return-1===a.called.indexOf(!1)},map:function(a){return a.arguments},destroy:function(){a.forEach(function(a,b){a.off("out",c[b]),a.off("data",c[b])})}});return a.forEach(function(a,b){f[b]=!1,c[b]=function(a){f[b]=!this.filtered,d[b]=a,g.push({arguments:d,called:f})},a.on("out",c[b]),a.on("data",c[b]),g.lastValue.push(a.lastValue)}),g},e.fromArray=function(a){var b=-1,d=a.length,f=new e({drain:function(){return++b<d?a[b]:c}});return f},e.fromPromise=function(a,b){var c=b instanceof e?b:new e;return a.then(function(a){c.push(a),c.destroy()},function(){c.trigger("error",arguments),c.destroy()}),c},e}(a,b),d=function(){return window.jQuery}(),e=function(a,b){return b.fn.streamOn=function(b,c){var d=new a;return this.on(b,c,function(a){d.push(a)}),d},b}(c,d)}();